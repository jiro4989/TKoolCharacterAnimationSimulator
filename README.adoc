= TKoolCharacterAnimationSimulator
:toc: left
:sectnums:

image:https://github.com/jiro4989/TKoolCharacterAnimationSimulator/workflows/test/badge.svg[test, link=https://github.com/jiro4989/TKoolCharacterAnimationSimulator/actions]
image:https://codecov.io/gh/jiro4989/TKoolCharacterAnimationSimulator/branch/master/graph/badge.svg[codecov, link=https://codecov.io/gh/jiro4989/TKoolCharacterAnimationSimulator]

image::./docs/tkcas_demo01.gif[]
image::./docs/tkcas_demo02.gif[]

== 概要

このソフトは、ペイントソフトでキャラチップを編集した時に、キャラチップのアニメー ションがゲーム内でどのように再生されるかをシミュレートするためのツールです。

キャラチップを上書き保存するなどして更新されたタイミングを監視し、変更された画像 をリアルタイムでシミュレートします。この際、本ソフトは画面最前面に表示することが 可能です。

これにより、イラストを手軽に編集し、その変更を容易に確認することが可能です。面倒 な確認作業にかかる時間を大幅に削減することができ、作成するキャラチップの品質向上 に役立てられるかと思います。

また、本ソフトはJava言語のみを使用してマルチプラットフォームを意識して作成しまし た。Mac環境では未確認ですが、Windows, Mac, LinuxといったメジャーなOSであればどの 環境でも動作するはずです。

== インストール

https://github.com/jiro4989/TKoolCharacterAnimationSimulator/releases[Releases]から各プラッ
トフォーム向けの圧縮ファイルをダウンロードして展開する。
圧縮ファイル内にはいくつかファイルがあるが、これらはセットで必要。任意のフォル
ダなどに移動したい場合は、展開したフォルダごと移動すること。

== 起動手順

. (Windows) tkcas.batをダブルクリックする
.. このとき警告が出る場合があるけれど、許可する
.. 黒いウィンドウが表示されるが、閉じないで待つ
.. GUIの画面が表示される
. (Mac/Linux) tkcasを実行する

== 使い方

=== ファイルを開く

ファイルメニューの'開く'を選択して、アニメーションしたいキャラチップを選択してく ださい。

この時、歩行グラのファイルを開いた場合、対象とするキャラを選択する必要があります 。ダブルクリックでアニメーションしたいキャラを選択してください。

=== 画像の確認

画像が正常に読み込めたかどうか確認します。

本ソフトでは表示しているキャラチップのアニメーション速度や拡大率を変更できます。 ショートカットキー、あるいはファイルメニューの'設定'の項目から変更できます。

正常にアニメーションで来ていれば成功です

=== 表示するレイアウトの調整

キャラチップの配置はウィンドウサイズに依存します。

ウィンドウの横幅が、すべてのキャラチップを表示するのに十分であった場合、キャラチ ップは1行ですべてを表示しようとします。

配置を1行ではなく2行に配置したいと考えた場合は、ウィンドウの横幅を縮小し、キャラ チップの配置が自分の期待しているようになるまで調整してください。

=== 画像規格プリセット

本ソフトではTKoolとタイトルに銘打っているとおり、RPGツクールシリーズの画像ファイ ルを扱うことが出来ます。

プリセットという設定ファイルを追加することで、柔軟に異なる画像規格のファイルでも アニメーションすることが可能になっています。

本ソフトでは配布時に自動でツクールMVとVXACEのプリセットを生成するようにしていま す。

それ以前のバージョンのツクールの画像をアニメーションしたい場合は、プリセットを自 作する必要があります。詳細はプリセットの編集の項目を参照し てください。

=== プリセットの確認

ファイルメニューの'歩行グラ'と'サイドビュー'という項目から現在のプリセットが確認 できます。

プリセットを変更したい場合はその下の'プリセットを開く'という項目から選択してくだ さい。

=== プリセットの編集

プリセットの編集画面を表示します。

この画面では行、列、1キャラチップあたりの横幅と高さ、アニメーションのフレーム数 を設定します。

プレビュー画像を読み込むと、画面右側の規格プレビューの下に比較用の画像を表示する ことができます。

=== プリセット編集画面の操作

行、列、横幅、高さの項目の左右にあるボタンは数値の増減を扱います。

行、列、横幅、高さの項目のテキスト入力欄上のでマウスホイールを使用すると、値を 増減します。

マウスホイールによる値の操作時にCtrlキー、またはShiftキーを押すと値の上限幅 を変更できます。

Ctrl : 5ずつ増減
Shift : 10ずつ増減

=== ショートカットキー

[options="header"]
|=========
|キー|動作
|Ctrl-O|歩行グラを開く
|Ctrl-Shift-O|サイドビューを開く
|Ctrl-P|歩行グラのプリセットを開く
|Ctrl-Shift-P|サイドビューのプリセットを開く
|Ctrl-E|歩行グラのプリセットを編集する
|Ctrl-Shift-E|サイドビューのプリセットを編集する
|Q|アニメーション画像の縮小
|E|アニメーション画像の拡大
|A|前の単一アニメーション画像に変更
|D|次の単一アニメーション画像に変更
|C|表示モードの切替
|W|アニメーションの低速化
|S|アニメーションの高速化
|F1|バージョン情報
|=========

=== マウス操作

[options="header"]
|=========
|マウス|対象|動作
|ダブルクリック|パネル|クリックしたパネルのみを表示
|ダブルクリック|パネル|パネルをすべて表示
|ドラッグ|ウィンドウ内|ウィンドウ位置の移動
|=========

== アンインストール

フォルダごと削除する。

== 連絡先

バグ報告、機能要望、質問などがあれば、リポジトリのissuesに起票ください。

それ以外については、以下に連絡ください。

https://twitter.com/jiro_saburomaru[@jiro_saburomaru]

== LICENSE

GPL-2.0

== 開発者向け

=== 前提条件

* Java 14

環境変数JAVA_HOMEも設定すること。
以下のコマンドでUbuntuでは環境が整う。

[source,bash]
----
curl -O https://download.java.net/java/GA/jdk14/076bab302c7b4508975440c56f6cc26a/36/GPL/openjdk-14_linux-x64_bin.tar.gz
tar xvf openjdk-14_linux-x64_bin.tar.gz

mkdir -p /opt/java
mv jdk-14 /opt/java/
ln -sfn /opt/java/jdk-14 /opt/java/current

export JAVA_HOME=/opt/java/current
----

=== ビルド手順

以下のコマンドを実行する。

[source,bash]
----
./gradlew build
----

=== アプリ起動手順

前述のビルドコマンドを実行後に以下のコマンドを実行する。

実行する前提条件として、下記スクリプトにかかれている `module-path`
のパスにJavaFX SDKがインストールされている必要がある。 JavaFX SDKは
https://gluonhq.com/products/javafx/[JavaFXのサイト]
からSDKをダウンロードしてきて圧縮ファイルを展開して配置する。

[source,bash]
----
./gradlew clean build runApp
----

=== カスタムJREの作成手順

以下のコマンドを実行する。成果物としてjreディレクトリが作成される。

アプリが依存しているモジュールは `modules.txt`
に記載。ここに追記するとスクリプトにも反映される。

実行する前提条件として、前述のJavaFXのサイトにて配布されているJMODSが必要。
こちらをダウンロードしてきて、 `./jmods/javafx-jmods-11.0.2` に配置する。

配置後に以下のコマンドを実行する。

[source,bash]
----
./gradlew jlink
----

=== カスタムJREを使用してアプリを起動する手順

以下の手順を実施する。

* ビルド手順
* カスタムJRE作成手順

実施の後、以下のコマンドを実行する。

[source,bash]
----
./jre/bin/java -jar build/libs/tkfm-dev.jar com.jiro4989.tkfm.Main
----

これで起動しなければ何かがおかしい。

=== リリース手順

gitのtagを切るとCIが起動して自動リリースされます。
リリースはすべてCI環境で行うため、環境を整える必要はありません。

masterブランチで以下の手順でコマンドを実行するとリリースされます。

[source,bash]
----
# v1.0.0は任意のタグ
git tag v1.0.0
git push origin v1.0.0
----
